# 狼人殺 MVP 設定說明

## 概述

這是一個 10 人警長局狼人殺遊戲的 MVP（最小可玩版本），支援現場模式（每個玩家使用自己的裝置）。

## 功能

- ✅ 10 人房間建立與加入
- ✅ 角色自動分配（3 狼人、1 預言家、1 女巫、1 獵人、4 村民）
- ✅ 完整遊戲流程：
  - 首夜：狼人殺人 → 女巫行動 → 預言家查驗 → 獵人查看手勢 → 警長競選
  - 白天：公布死訊 → 獵人夜槍（如適用）→ 發言 → 投票處決 → 獵人白天槍（如適用）
  - 夜晚循環：狼人 → 女巫 → 預言家 → 獵人
- ✅ 勝負判定（狼人勝利 / 好人勝利）
- ✅ Socket.IO 即時同步
- ✅ 玩家視角（公開資訊 + 私有資訊）

## 啟動步驟

### 1. 安裝依賴

```bash
npm install
```

### 2. 啟動 Socket.IO 伺服器

在一個終端視窗中：

```bash
npm run socket-server
```

伺服器將在 `http://localhost:4001` 啟動（或使用 `PORT` 環境變數指定的端口）。

### 3. 啟動 Next.js 開發伺服器

在另一個終端視窗中：

```bash
npm run dev
```

應用程式將在 `http://localhost:3000` 啟動。

### 4. 設定環境變數

確保 `.env` 檔案中包含：

```
DATABASE_URL="your_postgresql_connection_string"
DIRECT_URL="your_postgresql_direct_connection_string"
NEXT_PUBLIC_SOCKET_URL="ws://localhost:4001"
```

## 使用方式

1. **建立房間**：
   - 訪問首頁
   - 點擊「建立房間」
   - 選擇「10 人（狼人殺）」
   - 輸入房間名稱

2. **加入房間**：
   - 其他玩家可以：
     - 掃描 QR Code
     - 或輸入房間代碼加入
   - 首次加入需要輸入暱稱（會儲存在 localStorage）

3. **開始遊戲**：
   - 當房間有 10 位玩家時，房主可以點擊「開始遊戲」
   - 系統會自動分配角色
   - 每位玩家會看到自己的角色

4. **遊戲進行**：
   - 按照遊戲流程進行
   - 每個階段會顯示可用的操作
   - 點擊按鈕執行操作

## 遊戲規則（V1）

### 角色配置
- 狼人：3 人
- 預言家：1 人
- 女巫：1 人
- 獵人：1 人
- 村民：4 人

### 特殊規則
- **女巫**：
  - 不能自救（首夜也不能）
  - 解藥總共只能用一次
  - 毒藥總共只能用一次
  - 同一晚不能同時使用解藥+毒藥

- **獵人**：
  - 被毒不能開槍
  - 被刀 / 被投票處決可開槍

- **警長**：
  - 票權 1.5 票
  - 死後可指定一人繼承警徽（V1 尚未實作，預設無警長繼承）

- **平票規則**：
  - V1 簡化為「平票無人出局 → 直接入夜」

## 技術架構

- **前端**：Next.js 15 (App Router) + TypeScript + Tailwind CSS
- **後端**：Socket.IO 伺服器（獨立 Node.js 進程）
- **資料庫**：Prisma + PostgreSQL（房間持久化）
- **遊戲狀態**：記憶體中維護（Map<roomId, GameState>）

## 檔案結構

```
src/lib/games/werewolf/
  ├── types.ts      # 型別定義
  └── engine.ts    # 遊戲引擎核心邏輯

socket-server.ts    # Socket.IO 伺服器

src/app/game/[roomId]/
  └── page.tsx     # 遊戲房間頁面
```

## 已知限制（MVP 版本）

- UI 較為陽春（文字 + 按鈕）
- 沒有圓桌視覺化
- 沒有發言計時器
- 沒有視訊/音訊功能
- 警長繼承功能尚未實作
- 平票處理簡化

## 下一步改進

- [ ] 美化 UI（圓桌視覺化、動畫效果）
- [ ] 發言計時器
- [ ] 警長繼承功能
- [ ] 更完整的平票處理
- [ ] 遊戲歷史記錄
- [ ] 重播功能
