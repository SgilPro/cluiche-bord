# Cluiche Bord 專案開發規則

## 專案概述
這是一個使用 Next.js 15、TypeScript、Prisma、Socket.IO 建立的桌遊平台專案。

## 核心原則

### 1. 程式碼品質
- **型別安全**：嚴格使用 TypeScript，避免使用 `any`，優先使用型別推斷
- **錯誤處理**：所有 API 路由和異步操作必須包含適當的錯誤處理
- **程式碼審查**：每次修改後自動執行 `npm run lint` 和型別檢查
- **測試優先**：新功能必須包含測試（單元測試或整合測試）

### 2. 架構規範
- **檔案結構**：遵循 Next.js App Router 規範
  - API 路由：`src/app/api/`
  - 頁面：`src/app/`
  - 共用元件：`src/components/`
  - 共用邏輯：`src/lib/`
- **命名規範**：
  - 元件：PascalCase（如 `GameRoom.tsx`）
  - 函式/變數：camelCase（如 `createRoom`）
  - 常數：UPPER_SNAKE_CASE（如 `MAX_PLAYERS`）
  - 型別/介面：PascalCase（如 `GameState`）
- **路徑別名**：使用 `@/` 別名引用 `src/` 目錄下的檔案

### 3. 技術堆疊規範
- **前端框架**：Next.js 15 (App Router)
- **樣式**：Tailwind CSS 4
- **狀態管理**：React Hooks + Context API（未來考慮 Zustand）
- **資料庫**：Prisma ORM + PostgreSQL
- **即時通訊**：Socket.IO（獨立伺服器）
- **型別檢查**：TypeScript strict mode

### 4. API 設計規範
- **RESTful API**：遵循 REST 原則
- **錯誤回應**：統一使用 JSON 格式，包含 `error` 和 `message` 欄位
- **狀態碼**：正確使用 HTTP 狀態碼（200, 201, 400, 401, 404, 500）
- **型別定義**：所有 API 請求/回應必須有 TypeScript 型別定義

### 5. Socket.IO 規範
- **事件命名**：使用命名空間和明確的事件名稱（如 `room:join`, `game:move`）
- **錯誤處理**：所有 socket 事件必須包含錯誤處理
- **連線管理**：使用 `src/lib/socket.ts` 統一管理 socket 連線
- **伺服器分離**：Socket.IO 伺服器獨立運行（`socket-server.js`）

### 6. 資料庫規範
- **Prisma Schema**：所有資料模型變更必須透過 migration
- **查詢優化**：避免 N+1 查詢，使用 `include` 或 `select` 優化
- **資料驗證**：在 Prisma schema 層級和 API 層級都進行驗證

### 7. 開發工作流程
- **分支策略**：
  - `main`：穩定版本
  - `develop`：開發分支
  - `feature/*`：新功能
  - `fix/*`：錯誤修復
- **提交訊息**：使用語意化提交訊息（feat, fix, docs, style, refactor, test, chore）
- **程式碼審查**：所有變更必須經過審查

### 8. 安全性規範
- **環境變數**：敏感資訊必須使用環境變數，不得硬編碼
- **輸入驗證**：所有使用者輸入必須驗證和清理
- **認證授權**：API 路由必須檢查使用者認證狀態
- **CORS**：正確設定 CORS 政策

### 9. 效能規範
- **程式碼分割**：使用 Next.js 動態導入（`dynamic import`）
- **圖片優化**：使用 Next.js Image 元件
- **快取策略**：適當使用 Next.js 快取機制
- **資料庫查詢**：避免不必要的查詢，使用索引優化

### 10. 文件規範
- **程式碼註解**：複雜邏輯必須有註解說明
- **API 文件**：重要 API 必須有文件說明
- **型別定義**：使用 TypeScript 型別作為文件的一部分

## 常用指令

### 開發
- `npm run dev`：啟動開發伺服器
- `npm run build`：建置生產版本
- `npm run start`：啟動生產伺服器
- `npm run lint`：執行 ESLint 檢查

### 資料庫
- `npx prisma migrate dev`：建立並執行 migration
- `npx prisma generate`：產生 Prisma Client
- `npx prisma studio`：開啟 Prisma Studio

### Socket.IO
- `node socket-server.js`：啟動 Socket.IO 伺服器

## 禁止事項
- ❌ 不要使用 `any` 型別（除非絕對必要）
- ❌ 不要直接修改 Prisma schema 而不建立 migration
- ❌ 不要在程式碼中硬編碼敏感資訊
- ❌ 不要忽略錯誤處理
- ❌ 不要建立過於複雜的元件（超過 300 行應考慮拆分）

## 參考文件
- 專案規劃：`docs/plan.md`
- 專案規格：`docs/spec.md`
- 詳細規則：`.cursor/rules/`
- 自訂命令：`.cursor/commands/`
